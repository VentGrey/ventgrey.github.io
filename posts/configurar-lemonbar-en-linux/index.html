<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Configurar lemonbar en linux | La Esquina Gris</title><meta name=keywords content="Linux,Gnu,Tutoriales,Window Managers,C,Bash,Rust,LeftWM,fifo"><meta name=description content="Todos los que hemos usado un Window Manager en Gnu/Linux hemos pensado en lemonbar, una barra simple, minimalista y experta en causar alopecia por estrés. ¡Acompañame a aprender a configurarla!"><meta name=author content="VentGrey"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="Iyb36hxWrYaEXR1JJHRsc-E3vXidjcKH8hdE1pU5KxA"><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ventgrey.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ventgrey.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ventgrey.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ventgrey.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ventgrey.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Configurar lemonbar en linux"><meta property="og:description" content="Todos los que hemos usado un Window Manager en Gnu/Linux hemos pensado en lemonbar, una barra simple, minimalista y experta en causar alopecia por estrés. ¡Acompañame a aprender a configurarla!"><meta property="og:type" content="article"><meta property="og:url" content="https://ventgrey.github.io/posts/configurar-lemonbar-en-linux/"><meta property="og:image" content="https://ventgrey.github.io/img/posts/lemonbar/cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-01T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-01T00:00:00+00:00"><meta property="og:site_name" content="La Esquina Gris - Escribo un blog por terapia"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ventgrey.github.io/img/posts/lemonbar/cover.png"><meta name=twitter:title content="Configurar lemonbar en linux"><meta name=twitter:description content="Todos los que hemos usado un Window Manager en Gnu/Linux hemos pensado en lemonbar, una barra simple, minimalista y experta en causar alopecia por estrés. ¡Acompañame a aprender a configurarla!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ventgrey.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Configurar lemonbar en linux","item":"https://ventgrey.github.io/posts/configurar-lemonbar-en-linux/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Configurar lemonbar en linux","name":"Configurar lemonbar en linux","description":"Todos los que hemos usado un Window Manager en Gnu/Linux hemos pensado en lemonbar, una barra simple, minimalista y experta en causar alopecia por estrés. ¡Acompañame a aprender a configurarla!","keywords":["Linux","Gnu","Tutoriales","Window Managers","C","Bash","Rust","LeftWM","fifo"],"articleBody":"Lemonbar, la barra de estado que te dispara en el pie si así lo deseas. Uno de los aspectos de “Hacer más con menos” en los window managers es la inclusión de una barra de estado. En entornos de escritorio es posible añadir applets o widgets en pantalla que nos muestren múltiples líneas de información sobre el estado actual de nuestro sistema, esta información puede representar cosas diferentes, la fecha y hora, la batería restante, el estado de la red / bluetooth, la carga del sistema, etc.\nPor lo general yo no incluía esta información en mis paneles o en mi escritorio, pues los entornos ya son bastante “pesados” en sí mismos y añadir cosas encima solo los haría más lentos. Sin embargo, con un Window Manager ligero a mi disposición consideré que podía darme el lujo de añadir dicha información para verla constantemente.\nComencé usando polybar, porque la configuración es sencilla y no toma más de 5 minutos aprender a dejarla con la información que te gusta, el problema para mí es que Polybar consumía 26~30Mb de RAM en mi sistema y esa cantidad de memoria consumida para algo tan sencillo como una barra es INACEPTABLE. Por lo que comencé a buscar alternativas que pudiese utilizar y, luego de ver más de 18 status bar (todas feas, debo decir) llegué a la conclusión de que la mejor opción era una barra llamada lemonbar. Era la opción más minimalista y tenía una excusa perfecta para usarla: Lemonbar procesa todo por “strings” que uno le pasa a través de un pipe, como obtener información y como desplegarla a lemonbar es problema de quien la utiliza, por lo que, tú te encargas de configurar todo y tú eres el único responsable de que tan rápida y ligera o que tan lenta y pesada es tu barra de estado.\nEsto era perfecto para mí, pues mataba a dos pájaros de un tiro, tendría una barra que se ajuste 1:1 a mis necesidades Y podría practicar el uso de scripts en shell y programación en C y aprender un par de trucos nuevos. La idea general de una barra de estado es monitorear el sistema y su estado de la forma más básica que sea legible para nosotros, por lo que no buscaba incluir indicadores de música, layout del window manager o cosas más vagas como frases aleatorias del comando fortune. La implementación final se ve así:\nAhora es momento de explicar como configuré los elementos que se ven en la barra y como tú puedes lograr configuraciones similares en caso de que decidas usar lemonbar en un futuro cercano.\nA grandes rasgos, lemonbar solo dibuja una barra con texto, como meter ese texto es cosa del usuario. El problema de lemonbar viene cuando queremos calcular “al vuelo” e imprimir en la misma barra. Lemonbar no es multihilo / multiproceso y procesar todo bajo el mismo lugar puede ocasionar dos cosas:\nFormaremos un cuello de botella y la barra comenzará a mostrar información “tarde” o simplemente se congelará. El proceso tendrá que invocar muchos programas en el mismo trabajo, en poco tiempo y esto consumirá una cantidad ENORME de cpu. En cualquier caso, hay que tener cuidado al momento de usar lemonbar. La solución que encontré y que escribí basándome en un par de videos de Youtube y el trabajo de otros usuarios de window managers (BSPWM para ser precisos) fue la siguiente:\nReducir la cantidad de comandos / archivos de shell e implementar “getters” de información sencilla en C o Rust Crear un FIFO para que los comandos necesarios escriban su información ahí en lugar de escribirla directamente en la barra. Imprimir la información de los comandos con un prefijo fácil de eliminar, por ejemplo V:75% para el volumen del sistema. Leer el archivo FIFO línea por línea y enviar la información a su respecitivo lugar en la barra. Veamos los pasos uno a uno:\nImprimir los espacios de trabajo en lemonbar Antes de empezar tengo que decir que, todo esto se está realizando en un script de shell. Tengo una preferencia personal por la shell estándar, por lo que recomiendo que dejes la primera línea de tu script como: #!/bin/sh, que normalmente apunta a dash en algunas distribuciones. La razón es sencilla, las shells que son POSIX compliant son mejores, más seguras y más rápidas.\nDicho esto, comencemos…\nActualización del 2022: Desde hace tiempo mi tema Epitaph ya no hace uso de los programas wmdesk y wmwindow para imprimir los espacios de trabajo y la ventana activa respectivamente, en su lugar usamos la sintáxis de liquid que entiende LeftWM.\nEl código que usamos para lograr esto es el siguiente:\nleftwm-state -s \"{{workspaces[0].index | remove:'0'}}\" | while read -r _; do get_tags=$(leftwm-state -w0 -q -s \"{% for tag in workspace.tags %}{% if tag.mine %}%{R} {{tag.name}} %{R}{% elsif tag.visible %} {{tag.name}} {% elsif tag.busy %} {{tag.name}} {% else %} {{tag.name}}{% endif %}{% endfor %} | {{window_title}}\") echo \"K:$get_tags\" done Imprimir información general del sistema en Lemonbar El mismo principio puede ser aplicado a diferentes módulos, con una diferencia en específico. El cambio de espacios de trabajo solo debe verse reflejado cuando hay un “cambio de estado” en el window manager, es decir, cuando cambia una ventana o cuando cambiamos de estado de trabajo.\nEn el caso de los módulos de batería, volúmen y otros, es mejor hacer un ciclo infinito y poner a “dormir” el trabajo durante algunos segundos o milisegundos antes de volver a actualizar la información.\nEs importante no saltar el sleep en este caso, si nuestros módulos se actualizan muy rápido puede ser que tengan un impacto en la CPU de nuestro equipo O que simplemente no permitan a lemonbar dibujar las cosas a tiempo y cause bugs visuales.\nEn mi caso no leo constantemente el módulo de fecha y hora ni el módulo de internet, por lo que, puedo esperar 3 segundos para ver una actualización de los mismos en lemonbar:\n_Modules() { while true; do echo \"S:$(/usr/sbin/iwgetid -r || printf '%s' 'Disconnected')\" echo \"T:$(\"$HOME\"/.config/leftwm/themes/epitaph/scripts/lemonbar/time \u0026)\" sleep 3 done } Podemos hacer lo mismo con otros módulos, separándolos por funciones con sus propios retrasos entre actualizaciones para evitar forzar nuestra computadora:\n# No necesitamos ver el CPU y la RAM constantemente, podemos hacerlo en intervalos de 5 segundos. _SysInfoModule() { while true; do echo \"C:$(\"$HOME\"/.config/leftwm/themes/epitaph/scripts/lemonbar/cpu_usage \u0026)\" echo \"R:$(\"$HOME\"/.config/leftwm/themes/epitaph/scripts/lemonbar/ram_usage \u0026)\" sleep 5; done } # La batería no es algo que se descargue tan rápido, podemos revisarla igual, cada 5 segundos. _BatModule() { while true; do echo \"B:$(\"$HOME\"/.config/leftwm/themes/epitaph/scripts/lemonbar/battery \u0026)\" sleep 5; done } # En mi caso, el volúmen debería aparecer casi de inmediato al ser cambiado. _VolModule() { while true; do echo \"V:$(\"$HOME\"/.config/leftwm/themes/epitaph/scripts/lemonbar/getvol \u0026)\" sleep 0.2; done } Antes de comenzar con la magia negra, necesitamos crear una última función. El tiempo de actualización de esta no será en un lapso de tiempo definido, será cada que una línea cambie en el FIFO que definiremos más adelante, en específico las dos cosas que necesitan de este tipo de actualización en específico son:\nEL nombre de la ventana activa El espacio de trabajo actual Podemos implementarla de la siguiente forma:\n_Wininfo() { leftwm-state -s \"{{workspaces[0].index | remove:'0'}}\" | while read -r _; do get_tags=$(leftwm-state -w0 -q -s \"{% for tag in workspace.tags %}{% if tag.mine %}%{R} {{tag.name}} %{R}{% elsif tag.visible %} {{tag.name}} {% elsif tag.busy %} {{tag.name}} {% else %} {{tag.name}}{% endif %}{% endfor %} | {{window_title}}\") echo \"K:$get_tags\" done } Tengo que recalcar que, leftwm-state es un comando propio de leftwm que imprime una línea cada que el gestor de ventanas cambia de estado, esto puede variar de window manager a window manager.\nFIFO, cut y manipulación de salida en la shell Una vez definidos nuestros módulos necesitamos crear un FIFO (siglas para First In, First Out), esto lo haremos con una variable y el comando mkfifo. En sistemas tipo UNIX, mkfifo sirve para producir un archivo especial FIFO con un nombre o con una ruta. Este archivo especial puede ser leído o escrito por cualquier proceso del mismo modo que un archivo normal.\nPrimero definimos una variable para la ruta donde deberá ser creado nuestro fifo:\nlemon_fifo=\"/tmp/lemonfifo\" Es útil crearlo en /tmp por dos razones:\nEs una “regla de oro” colorcar los archivos cambiantes / temporales bajo /tmp. En caso de que alguno de los usuarios tenga un tmpfs montado en RAM. Como siguiente paso revisaremos si un archivo fifo del mismo nombre ya existe y, de ser el caso eliminarlo. Hecho esto tenemos que crear un nuevo fifo usando el comando mkfifo:\n[ -e \"$lemon_fifo\" ] \u0026\u0026 rm \"$lemon_fifo\" mkfifo \"$lemon_fifo\" Con nuestro fifo creado, ahora es necesario escribir en el archivo, para evitar usar comandos externos, podemos utilizar los operadores de redirección de salida de nuestra shell junto con el operador \u0026 al final de la línea, esto hará que, la escritura en el archivo sea de forma “asíncrona”, haciendo que, el proceso que termine primero, sea el primero en escribir y no haya bloqueos en la escritura de la barra. Para hacer todo esto solo es necesario llamar las funciones que definimos antes, seguidas del operador \u003e, el lugar donde deberá ir la salida de los comandos. En este caso $lemon_fifo y finalmente el operador \u0026:\n_VolModule \u003e \"$lemon_fifo\" \u0026 _BatModule \u003e \"$lemon_fifo\" \u0026 _SysInfoModule \u003e \"$lemon_fifo\" \u0026 _Modules \u003e \"$lemon_fifo\" \u0026 _Wininfo \u003e \"$lemon_fifo\" \u0026 Esto se encargará de escribir continuamente en nuestro archivo fifo, podemos comprobar que las cosas están funcionando con el siguiente comando:\n$ cat $lemon_fifo C: 4% V:100% V:100% V:100% B: 86% V:100% Espera un momento…Hay algo raro en esa salida. ¿No notas algo raro?\nExacto, todas las salidas tienen un “prefijo” que consta de una letra, seguida de dos puntos :, si eres observador/a te diste cuenta desde el momento en el que definimos las funciones de los módulos. Bueno, estos prefijos los utilizaremos en nuestra función _Main(). Esta función se encargará de leer el archivo fifo y se encargará de hacer dos cosas:\n“Recortar” la información de cada línea del fifo. Imprimir la información recordada a lemonbar Veamos primero la función y la explicaremos línea por línea:\n_Main() { while read -r report; do case $report in B*) batt=\"$(echo \"${report##*:}\")\";; C*) cpu=\"$(echo \"${report##*:}\")\";; K*) wm=\"$(echo \"${report##*:}\")\";; R*) ram=\"$(echo \"${report##*:}\")\";; S*) ssid=\"$(echo \"${report##*:}\")\";; T*) time=\"$(echo \"$report\" | cut -d':' -f2-)\";; V*) vol=\"$(echo \"${report##*:}\")\";; W*) wname=\"$(echo \"${report##*:}\")\";; esac sleep 0.1s printf \"%s\" \"%{F#FAFAFA}%{R} $wm %{R} $wname... %{r}%{B#282c34}%{F#E06c75}%{R}%{F#282c34} 龍 cpu: $cpu %{F#E5C07B}%{B#E06c75}%{R}%{F#282c34}  ram: $ram %{B#E5C07B}%{F#61AFEF}%{R}%{F#282c34}  $time %{B#61AFEF}%{F#98C379}%{R}%{F#282c34}  $batt %{B#98C379}%{F#DA8548}%{R}%{F#282c34} 墳 $vol %{B#DA8548}%{F#c678dd}%{R}%{F#282c34}  $ssid %{B#282c34}\" done } La parte while read -r ya la hemos visto antes, lo interesante es la parte de abajo, en shell la palabra case es similar a un switch en otros lenguajes (con sus respectivas diferencias técnicas), en este caso estamos buscando coincidencias con las letras en mayúsculas que definimos en los prefijos de las funciones de los módulos. Para ejemplificar mejor este ejemplo veamos el primer caso:\nB*) batt=\"$(echo \"${report##*:}\")\";; Esto quiere decir que, si la línea actual que está leyendo la función _Main comienza con la letra B y sigue “lo que sea” (*), en este caso los dos puntos, recortaremos esos dos elementos (La B:) y asignaremos lo que quede a la variable $batt. Todos los módulos funcionan de la misma manera salvo por el módulo de la fecha y hora: T*) time=\"$(echo \"$report\" | cut -d':' -f2-)\";;, la razón de esto es que el módulo de la fecha imprime por si solo dos puntos (en el formato Hora:minuto), si usamos la manipulación de variables de la shell todo sería recortado y nuestro calendario solo mostraría minuto). Cosa que no queremos.\nDebajo del case simplemente esperamos 0.1 segundos para actualizar la información de la barra, he intentado eliminarlo para que la actualización sea “inmediata”, el consumo de CPU no sube mucho, PERO, ocurre lo que dije anteriormente, las cosas son tan rápidas que lemonbar no tiene oportunidad de redibujarse y ocurren bugs visuales.\nLa orden printf es probablemente la más caótica y problemática de todas, por esa razón me reservaré algunos detalles, unicamente resaltaré que en ella imprimimos las variables que cambian dentro de _Main, podríamos incluirlas “Así nomas”, todos los símbolos extraños y operadores %{} son propios de lemonbar y puedes encontrar más informacion de ellos aquí.\nComo cierre del telón haremos uso de los operadores de redirección de la shell de nuevo, esta vez utilizaremos la redirección de entrada \u003c. Más arriba dije que la función iba a leer líneas, las líneas que debe leer son las líneas del archivo fifo, por lo que tenemos que redirigir la entrada del fifo a la función _Main:\n_Main \u003c \"$lemon_fifo\" Disfruta de tu lemonbar más rápida que el rayo ❤ Con esto, lograste crear la primera versión de tu configuración de lemonbar lista y funcional. Ahora es cuestión de empezar a investigar un poco más para ir modificándola poco a poco y dejarla cien por ciento a tu gusto.\nEl código mostrado en este blog es parte de Epitaph, un tema para LeftWM hecho por mí. Si utilizas este window manager te invito a darle una estrellita en GitHub ⭐\nSi deseas encontrar los programas que utilicé para los módulos, puedes encontrarlos todos aquí. Solo ten en cuenta que, ninguno de ellos es un script de shell, todos fueron escritos en lenguajes compilados y necesitarás un compilador de C y de Rust. Puedes encontrar las órdenes de compilación de cada uno en el archivo de instalación de Epitaph.\nEso es todo por el momento, si te gustó este blog compártelo con tus amigos y activa el RSS si deseas recibir actualizaciones cada que escriba una nueva entrada :)\n¿Te gustan estos blogs? Ayúdame a seguir escribiéndolos de las siguientes formas:\nInvítame un café 🍵 Regálame un follow en GitHub ❤ ","wordCount":"2299","inLanguage":"en","image":"https://ventgrey.github.io/img/posts/lemonbar/cover.png","datePublished":"2021-12-01T00:00:00Z","dateModified":"2021-12-01T00:00:00Z","author":{"@type":"Person","name":"VentGrey"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ventgrey.github.io/posts/configurar-lemonbar-en-linux/"},"publisher":{"@type":"Organization","name":"La Esquina Gris","logo":{"@type":"ImageObject","url":"https://ventgrey.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ventgrey.github.io/ accesskey=h title="La Esquina Gris (Alt + H)"><img src=https://ventgrey.github.io/apple-touch-icon.png alt aria-label=logo height=35>La Esquina Gris</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ventgrey.github.io/categories/ title=Categorias><span>Categorias</span></a></li><li><a href=https://ventgrey.github.io/tags/ title=Etiquetas><span>Etiquetas</span></a></li><li><a href=https://upvent.codes title="¿Buscas a UpVent?"><span>¿Buscas a UpVent?</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ventgrey.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://ventgrey.github.io/posts/>Posts</a></div><h1 class=post-title>Configurar lemonbar en linux</h1><div class=post-description>Todos los que hemos usado un Window Manager en Gnu/Linux hemos pensado en lemonbar, una barra simple, minimalista y experta en causar alopecia por estrés. ¡Acompañame a aprender a configurarla!</div><div class=post-meta><span title='2021-12-01 00:00:00 +0000 UTC'>December 1, 2021</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;2299 words&nbsp;·&nbsp;VentGrey&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/configurar-lemonbar-en-linux.md rel="noopener noreferrer" target=_blank>Sugerir Cambios</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#imprimir-los-espacios-de-trabajo-en-lemonbar>Imprimir los espacios de trabajo en lemonbar</a></li><li><a href=#imprimir-información-general-del-sistema-en-lemonbar>Imprimir información general del sistema en Lemonbar</a></li><li><a href=#fifo-cut-y-manipulación-de-salida-en-la-shell>FIFO, cut y manipulación de salida en la shell</a></li><li><a href=#disfruta-de-tu-lemonbar-más-rápida-que-el-rayo->Disfruta de tu lemonbar más rápida que el rayo ❤</a></li></ul></nav></div></details></div><div class=post-content><h1 id=lemonbar-la-barra-de-estado-que-te-dispara-en-el-pie-si-así-lo-deseas>Lemonbar, la barra de estado que te dispara en el pie si así lo deseas.<a hidden class=anchor aria-hidden=true href=#lemonbar-la-barra-de-estado-que-te-dispara-en-el-pie-si-así-lo-deseas>#</a></h1><p>Uno de los aspectos de <em>&ldquo;Hacer más con menos&rdquo;</em> en los window managers es la inclusión de una barra de estado. En entornos de escritorio es posible añadir applets o widgets en pantalla que nos muestren múltiples líneas de información sobre el estado actual de nuestro sistema, esta información puede representar cosas diferentes, la fecha y hora, la batería restante, el estado de la red / bluetooth, la carga del sistema, etc.</p><p>Por lo general yo no incluía esta información en mis paneles o en mi escritorio, pues los entornos ya son bastante <em>&ldquo;pesados&rdquo;</em> en sí mismos y añadir cosas encima solo los haría más lentos. Sin embargo, con un Window Manager ligero a mi disposición consideré que podía darme el lujo de añadir dicha información para verla constantemente.</p><p>Comencé usando <a href=https://github.com/polybar/polybar>polybar</a>, porque la configuración es sencilla y no toma más de 5 minutos aprender a dejarla con la información que te gusta, el problema para mí es que Polybar consumía 26~30Mb de RAM en mi sistema y esa cantidad de memoria consumida para algo tan sencillo como una barra es <strong>INACEPTABLE</strong>. Por lo que comencé a buscar alternativas que pudiese utilizar y, luego de ver más de 18 status bar (<em>todas feas, debo decir</em>) llegué a la conclusión de que la mejor opción era una barra llamada <a href=https://github.com/LemonBoy/bar>lemonbar</a>. Era la opción más minimalista y tenía una excusa perfecta para usarla: Lemonbar procesa todo por &ldquo;strings&rdquo; que uno le pasa a través de un <em>pipe</em>, como obtener información y como desplegarla a lemonbar es problema de quien la utiliza, por lo que, tú te encargas de configurar todo y tú eres el único responsable de que tan rápida y ligera o que tan lenta y pesada es tu barra de estado.</p><p>Esto era perfecto para mí, pues mataba a dos pájaros de un tiro, tendría una barra que se ajuste 1:1 a mis necesidades Y podría practicar el uso de scripts en shell y programación en C y aprender un par de trucos nuevos. La idea general de una barra de estado es monitorear el sistema y su estado de la forma más básica que sea legible para nosotros, por lo que no buscaba incluir indicadores de música, layout del window manager o cosas más vagas como frases aleatorias del comando <code>fortune</code>. La implementación final se ve así:</p><p><img loading=lazy src=/img/posts/lemonbar/barra.png alt=lemonbar></p><p>Ahora es momento de explicar como configuré los elementos que se ven en la barra y como tú puedes lograr configuraciones similares en caso de que decidas usar lemonbar en un futuro cercano.</p><p>A grandes rasgos, lemonbar solo dibuja una barra con texto, como meter ese texto es cosa del usuario. El problema de lemonbar viene cuando queremos calcular &ldquo;al vuelo&rdquo; e imprimir en la misma barra. Lemonbar no es multihilo / multiproceso y procesar todo bajo el mismo lugar puede ocasionar dos cosas:</p><ol><li>Formaremos un cuello de botella y la barra comenzará a mostrar información &ldquo;tarde&rdquo; o simplemente se congelará.</li><li>El proceso tendrá que invocar muchos programas en el mismo trabajo, en poco tiempo y esto consumirá una cantidad <strong>ENORME</strong> de cpu.</li></ol><p>En cualquier caso, hay que tener cuidado al momento de usar lemonbar. La solución que encontré y que escribí basándome en un par de videos de Youtube y el trabajo de otros usuarios de window managers (BSPWM para ser precisos) fue la siguiente:</p><ol><li>Reducir la cantidad de comandos / archivos de shell e implementar &ldquo;getters&rdquo; de información sencilla en C o Rust</li><li>Crear un FIFO para que los comandos necesarios escriban su información ahí en lugar de escribirla directamente en la barra.</li><li>Imprimir la información de los comandos con un prefijo fácil de eliminar, por ejemplo <code>V:75%</code> para el volumen del sistema.</li><li>Leer el archivo FIFO línea por línea y enviar la información a su respecitivo lugar en la barra.</li></ol><p>Veamos los pasos uno a uno:</p><h2 id=imprimir-los-espacios-de-trabajo-en-lemonbar>Imprimir los espacios de trabajo en lemonbar<a hidden class=anchor aria-hidden=true href=#imprimir-los-espacios-de-trabajo-en-lemonbar>#</a></h2><p>Antes de empezar tengo que decir que, todo esto se está realizando en un script de shell. Tengo una preferencia personal por la shell estándar, por lo que recomiendo que dejes la primera línea de tu script como: <code>#!/bin/sh</code>, que normalmente apunta a <code>dash</code> en algunas distribuciones. La razón es sencilla, las shells que son POSIX compliant son mejores, más seguras y más rápidas.</p><p>Dicho esto, comencemos&mldr;</p><p>Actualización del 2022: Desde hace tiempo mi tema Epitaph ya no hace uso de los programas <code>wmdesk</code> y <code>wmwindow</code> para imprimir los espacios de trabajo y la ventana activa respectivamente, en su lugar usamos la sintáxis de <em>liquid</em> que entiende LeftWM.</p><p>El código que usamos para lograr esto es el siguiente:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>leftwm-state -s <span class=s2>&#34;{{workspaces[0].index | remove:&#39;0&#39;}}&#34;</span> <span class=p>|</span> <span class=k>while</span> <span class=nb>read</span> -r _<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nv>get_tags</span><span class=o>=</span><span class=k>$(</span>leftwm-state -w0 -q -s <span class=s2>&#34;{% for tag in workspace.tags %}{% if tag.mine %}%{R} {{tag.name}} %{R}{% elsif tag.visible %} {{tag.name}} {% elsif tag.busy %} {{tag.name}} {% else %} {{tag.name}}{% endif %}{% endfor %} | {{window_title}}&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;K:</span><span class=nv>$get_tags</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></div><p><img loading=lazy src=/img/posts/lemonbar/workspaces.png alt=Workspaces></p><h2 id=imprimir-información-general-del-sistema-en-lemonbar>Imprimir información general del sistema en Lemonbar<a hidden class=anchor aria-hidden=true href=#imprimir-información-general-del-sistema-en-lemonbar>#</a></h2><p>El mismo principio puede ser aplicado a diferentes módulos, con una diferencia en específico. El cambio de espacios de trabajo solo debe verse reflejado cuando hay un &ldquo;cambio de estado&rdquo; en el window manager, es decir, cuando cambia una ventana o cuando cambiamos de estado de trabajo.</p><p>En el caso de los módulos de batería, volúmen y otros, es mejor hacer un ciclo infinito y poner a &ldquo;dormir&rdquo; el trabajo durante algunos segundos o milisegundos antes de volver a actualizar la información.</p><blockquote><p>Es importante no saltar el <code>sleep</code> en este caso, si nuestros módulos se actualizan muy rápido puede ser que tengan un impacto en la CPU de nuestro equipo O que simplemente no permitan a lemonbar dibujar las cosas a tiempo y cause bugs visuales.</p></blockquote><p>En mi caso no leo constantemente el módulo de fecha y hora ni el módulo de internet, por lo que, puedo esperar 3 segundos para ver una actualización de los mismos en lemonbar:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>_Modules<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>                <span class=nb>echo</span> <span class=s2>&#34;S:</span><span class=k>$(</span>/usr/sbin/iwgetid -r <span class=o>||</span> <span class=nb>printf</span> <span class=s1>&#39;%s&#39;</span> <span class=s1>&#39;Disconnected&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=nb>echo</span> <span class=s2>&#34;T:</span><span class=k>$(</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>&#34;</span>/.config/leftwm/themes/epitaph/scripts/lemonbar/time <span class=p>&amp;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                sleep <span class=m>3</span>
</span></span><span class=line><span class=cl>        <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><img loading=lazy src=/img/posts/lemonbar/internet.png alt=Internet>
<img loading=lazy src=/img/posts/lemonbar/cal.png alt=Calendar></p><p>Podemos hacer lo mismo con otros módulos, separándolos por funciones con sus propios retrasos entre actualizaciones para evitar forzar nuestra computadora:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># No necesitamos ver el CPU y la RAM constantemente, podemos hacerlo en intervalos de 5 segundos.</span>
</span></span><span class=line><span class=cl>_SysInfoModule<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>                <span class=nb>echo</span> <span class=s2>&#34;C:</span><span class=k>$(</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>&#34;</span>/.config/leftwm/themes/epitaph/scripts/lemonbar/cpu_usage <span class=p>&amp;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=nb>echo</span> <span class=s2>&#34;R:</span><span class=k>$(</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>&#34;</span>/.config/leftwm/themes/epitaph/scripts/lemonbar/ram_usage <span class=p>&amp;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                sleep 5<span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><img loading=lazy src=/img/posts/lemonbar/cpu.png alt=CPU>
<img loading=lazy src=/img/posts/lemonbar/mem.png alt=MEM></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># La batería no es algo que se descargue tan rápido, podemos revisarla igual, cada 5 segundos.</span>
</span></span><span class=line><span class=cl>_BatModule<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>            <span class=nb>echo</span> <span class=s2>&#34;B:</span><span class=k>$(</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>&#34;</span>/.config/leftwm/themes/epitaph/scripts/lemonbar/battery <span class=p>&amp;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            sleep 5<span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><img loading=lazy src=/img/posts/lemonbar/batt.png alt=Battery></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># En mi caso, el volúmen debería aparecer casi de inmediato al ser cambiado.</span>
</span></span><span class=line><span class=cl>_VolModule<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;V:</span><span class=k>$(</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>&#34;</span>/.config/leftwm/themes/epitaph/scripts/lemonbar/getvol <span class=p>&amp;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        sleep 0.2<span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><img loading=lazy src=/img/posts/lemonbar/vol.png alt=Volume></p><p>Antes de comenzar con la magia negra, necesitamos crear una última función. El tiempo de actualización de esta no será en un lapso de tiempo definido, será cada que una línea cambie en el FIFO que definiremos más adelante, en específico las dos cosas que necesitan de este tipo de actualización en específico son:</p><ul><li>EL nombre de la ventana activa</li><li>El espacio de trabajo actual</li></ul><p>Podemos implementarla de la siguiente forma:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>_Wininfo<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    leftwm-state -s <span class=s2>&#34;{{workspaces[0].index | remove:&#39;0&#39;}}&#34;</span> <span class=p>|</span> <span class=k>while</span> <span class=nb>read</span> -r _<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=nv>get_tags</span><span class=o>=</span><span class=k>$(</span>leftwm-state -w0 -q -s <span class=s2>&#34;{% for tag in workspace.tags %}{% if tag.mine %}%{R} {{tag.name}} %{R}{% elsif tag.visible %} {{tag.name}} {% elsif tag.busy %} {{tag.name}} {% else %} {{tag.name}}{% endif %}{% endfor %} | {{window_title}}&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;K:</span><span class=nv>$get_tags</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><img loading=lazy src=/img/posts/lemonbar/workspaces.png alt=Workspaces>
<img loading=lazy src=/img/posts/lemonbar/activewin.png alt=ActiveWindow></p><p>Tengo que recalcar que, <code>leftwm-state</code> es un comando propio de leftwm que imprime una línea cada que el gestor de ventanas cambia de estado, esto puede variar de window manager a window manager.</p><h2 id=fifo-cut-y-manipulación-de-salida-en-la-shell>FIFO, cut y manipulación de salida en la shell<a hidden class=anchor aria-hidden=true href=#fifo-cut-y-manipulación-de-salida-en-la-shell>#</a></h2><p><img loading=lazy src=https://plantillasdememes.com/img/plantillas/ahora-si-viene-lo-chido21574322946.jpg alt=meme></p><p>Una vez definidos nuestros módulos necesitamos crear un FIFO (siglas para <em>First In, First Out</em>), esto lo haremos con una variable y
el comando <code>mkfifo</code>. En sistemas tipo UNIX, <code>mkfifo</code> sirve para producir un archivo especial <em>FIFO</em> con un nombre o con una ruta. Este archivo especial puede ser leído o escrito por cualquier proceso del mismo modo que un archivo normal.</p><p>Primero definimos una variable para la ruta donde deberá ser creado nuestro <em>fifo</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>lemon_fifo</span><span class=o>=</span><span class=s2>&#34;/tmp/lemonfifo&#34;</span>
</span></span></code></pre></div><p>Es útil crearlo en <code>/tmp</code> por dos razones:</p><ol><li>Es una &ldquo;regla de oro&rdquo; colorcar los archivos cambiantes / temporales bajo <code>/tmp</code>.</li><li>En caso de que alguno de los usuarios tenga un <code>tmpfs</code> montado en RAM.</li></ol><p>Como siguiente paso revisaremos si un archivo <em>fifo</em> del mismo nombre ya existe y, de ser el caso eliminarlo. Hecho esto tenemos que crear un nuevo <em>fifo</em> usando el comando <code>mkfifo</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span> -e <span class=s2>&#34;</span><span class=nv>$lemon_fifo</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> rm <span class=s2>&#34;</span><span class=nv>$lemon_fifo</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>mkfifo <span class=s2>&#34;</span><span class=nv>$lemon_fifo</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>Con nuestro <em>fifo</em> creado, ahora es necesario escribir en el archivo, para evitar usar comandos externos, podemos utilizar los operadores de redirección de salida de nuestra shell junto con el operador <code>&</code> al final de la línea, esto hará que, la escritura en el archivo sea de forma <em>&ldquo;asíncrona&rdquo;</em>, haciendo que, el proceso que termine primero, sea el primero en escribir y no haya bloqueos en la escritura de la barra. Para hacer todo esto solo es necesario llamar las funciones que definimos antes, seguidas del operador <code>></code>, el lugar donde deberá ir la salida de los comandos. En este caso <code>$lemon_fifo</code> y finalmente el operador <code>&</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>_VolModule &gt; <span class=s2>&#34;</span><span class=nv>$lemon_fifo</span><span class=s2>&#34;</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>_BatModule &gt; <span class=s2>&#34;</span><span class=nv>$lemon_fifo</span><span class=s2>&#34;</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>_SysInfoModule &gt; <span class=s2>&#34;</span><span class=nv>$lemon_fifo</span><span class=s2>&#34;</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>_Modules &gt; <span class=s2>&#34;</span><span class=nv>$lemon_fifo</span><span class=s2>&#34;</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>_Wininfo &gt; <span class=s2>&#34;</span><span class=nv>$lemon_fifo</span><span class=s2>&#34;</span> <span class=p>&amp;</span>
</span></span></code></pre></div><p>Esto se encargará de escribir continuamente en nuestro archivo <em>fifo</em>, podemos comprobar que las cosas están funcionando con el siguiente comando:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat <span class=nv>$lemon_fifo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C:  4%
</span></span><span class=line><span class=cl>V:100%
</span></span><span class=line><span class=cl>V:100%
</span></span><span class=line><span class=cl>V:100%
</span></span><span class=line><span class=cl>B: 86%
</span></span><span class=line><span class=cl>V:100%
</span></span></code></pre></div><p>Espera un momento&mldr;Hay algo raro en esa salida. ¿No notas algo raro?</p><p>Exacto, todas las salidas tienen un &ldquo;prefijo&rdquo; que consta de una letra, seguida de dos puntos <code>:</code>, si eres observador/a te diste cuenta desde el momento en el que definimos las funciones de los módulos. Bueno, estos prefijos los utilizaremos en nuestra función <code>_Main()</code>. Esta función se encargará de leer el archivo <em>fifo</em> y se encargará de hacer dos cosas:</p><ol><li>&ldquo;Recortar&rdquo; la información de cada línea del <em>fifo</em>.</li><li>Imprimir la información recordada a lemonbar</li></ol><p>Veamos primero la función y la explicaremos línea por línea:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>_Main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=nb>read</span> -r report<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nv>$report</span> in
</span></span><span class=line><span class=cl>                        B*<span class=o>)</span> <span class=nv>batt</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>report</span><span class=p>##*:</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>                        C*<span class=o>)</span> <span class=nv>cpu</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>report</span><span class=p>##*:</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>                        K*<span class=o>)</span> <span class=nv>wm</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>report</span><span class=p>##*:</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>                        R*<span class=o>)</span> <span class=nv>ram</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>report</span><span class=p>##*:</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>                        S*<span class=o>)</span> <span class=nv>ssid</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>report</span><span class=p>##*:</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>                        T*<span class=o>)</span> <span class=nv>time</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$report</span><span class=s2>&#34;</span> <span class=p>|</span> cut -d<span class=s1>&#39;:&#39;</span> -f2-<span class=k>)</span><span class=s2>&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>                        V*<span class=o>)</span> <span class=nv>vol</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>report</span><span class=p>##*:</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>                        W*<span class=o>)</span> <span class=nv>wname</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>report</span><span class=p>##*:</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>                <span class=k>esac</span>
</span></span><span class=line><span class=cl>                sleep 0.1s
</span></span><span class=line><span class=cl>                <span class=nb>printf</span> <span class=s2>&#34;%s&#34;</span> <span class=s2>&#34;%{F#FAFAFA}%{R} </span><span class=nv>$wm</span><span class=s2> %{R} </span><span class=nv>$wname</span><span class=s2>... %{r}%{B#282c34}%{F#E06c75}%{R}%{F#282c34} 龍 cpu: </span><span class=nv>$cpu</span><span class=s2> %{F#E5C07B}%{B#E06c75}%{R}%{F#282c34}  ram: </span><span class=nv>$ram</span><span class=s2> %{B#E5C07B}%{F#61AFEF}%{R}%{F#282c34}  </span><span class=nv>$time</span><span class=s2> %{B#61AFEF}%{F#98C379}%{R}%{F#282c34}  </span><span class=nv>$batt</span><span class=s2> %{B#98C379}%{F#DA8548}%{R}%{F#282c34} 墳 </span><span class=nv>$vol</span><span class=s2> %{B#DA8548}%{F#c678dd}%{R}%{F#282c34}  </span><span class=nv>$ssid</span><span class=s2> %{B#282c34}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>La parte <code>while read -r</code> ya la hemos visto antes, lo interesante es la parte de abajo, en shell la palabra <code>case</code> es similar a un <code>switch</code> en otros lenguajes (con sus respectivas diferencias técnicas), en este caso estamos buscando coincidencias con las letras en mayúsculas que definimos en los prefijos de las funciones de los módulos. Para ejemplificar mejor este ejemplo veamos el primer caso:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>B*<span class=o>)</span> <span class=nv>batt</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>report</span><span class=p>##*:</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span><span class=p>;;</span>
</span></span></code></pre></div><p>Esto quiere decir que, si la línea actual que está leyendo la función <code>_Main</code> comienza con la letra <code>B</code> y sigue &ldquo;lo que sea&rdquo; (<code>*</code>), en este caso los dos puntos, recortaremos esos dos elementos (La <code>B:</code>) y asignaremos lo que quede a la variable <code>$batt</code>. Todos los módulos funcionan de la misma manera salvo por el módulo de la fecha y hora: <code>T*) time="$(echo "$report" | cut -d':' -f2-)";;</code>, la razón de esto es que el módulo de la fecha imprime por si solo dos puntos (en el formato <code>Hora:minuto</code>), si usamos la manipulación de variables de la shell todo sería recortado y nuestro calendario solo mostraría <code>minuto)</code>. Cosa que no queremos.</p><p>Debajo del <code>case</code> simplemente esperamos <code>0.1</code> segundos para actualizar la información de la barra, he intentado eliminarlo para que la actualización sea &ldquo;inmediata&rdquo;, el consumo de CPU no sube mucho, PERO, ocurre lo que dije anteriormente, las cosas son tan rápidas que lemonbar no tiene oportunidad de redibujarse y ocurren bugs visuales.</p><p>La orden <code>printf</code> es probablemente la más caótica y problemática de todas, por esa razón me reservaré algunos detalles, unicamente resaltaré que en ella imprimimos las variables que cambian dentro de <code>_Main</code>, podríamos incluirlas <em>&ldquo;Así nomas&rdquo;</em>, todos los símbolos extraños y operadores <code>%{}</code> son propios de lemonbar y puedes encontrar más informacion de ellos <a href=https://github.com/LemonBoy/bar#formatting>aquí</a>.</p><p>Como cierre del telón haremos uso de los operadores de redirección de la shell de nuevo, esta vez utilizaremos la redirección de entrada <code>&lt;</code>. Más arriba dije que la función iba a leer líneas, las líneas que debe leer son las líneas del archivo <em>fifo</em>, por lo que tenemos que redirigir la entrada del fifo a la función <code>_Main</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>_Main &lt; <span class=s2>&#34;</span><span class=nv>$lemon_fifo</span><span class=s2>&#34;</span>
</span></span></code></pre></div><h2 id=disfruta-de-tu-lemonbar-más-rápida-que-el-rayo->Disfruta de tu lemonbar más rápida que el rayo ❤<a hidden class=anchor aria-hidden=true href=#disfruta-de-tu-lemonbar-más-rápida-que-el-rayo->#</a></h2><p>Con esto, lograste crear la primera versión de tu configuración de lemonbar lista y funcional. Ahora es cuestión de empezar a investigar un poco más para ir modificándola poco a poco y dejarla cien por ciento a tu gusto.</p><p>El código mostrado en este blog es parte de <a href=https://github.com/VentGrey/Epitaph>Epitaph</a>, un tema para LeftWM hecho por mí. Si utilizas este window manager te invito a darle una estrellita en GitHub ⭐</p><p>Si deseas encontrar los programas que utilicé para los módulos, puedes encontrarlos todos <a href=https://github.com/VentGrey/Epitaph/tree/master/scripts/lemonbar>aquí</a>. Solo ten en cuenta que, ninguno de ellos es un script de shell, todos fueron escritos en lenguajes compilados y necesitarás un compilador de <code>C</code> y de <code>Rust</code>. Puedes encontrar las órdenes de compilación de cada uno en el <a href=https://github.com/VentGrey/Epitaph/blob/master/install>archivo de instalación de Epitaph</a>.</p><p>Eso es todo por el momento, si te gustó este blog compártelo con tus amigos y activa el RSS si deseas recibir actualizaciones cada que escriba una nueva entrada :)</p><hr><p>¿Te gustan estos blogs? Ayúdame a seguir escribiéndolos de las siguientes formas:</p><ul><li><a href=https://ko-fi.com/ventgrey>Invítame un café 🍵</a></li><li><a href=https://github.com/VentGrey>Regálame un follow en GitHub ❤</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://ventgrey.github.io/tags/linux/>Linux</a></li><li><a href=https://ventgrey.github.io/tags/gnu/>Gnu</a></li><li><a href=https://ventgrey.github.io/tags/tutoriales/>Tutoriales</a></li><li><a href=https://ventgrey.github.io/tags/window-managers/>Window Managers</a></li><li><a href=https://ventgrey.github.io/tags/c/>C</a></li><li><a href=https://ventgrey.github.io/tags/bash/>Bash</a></li><li><a href=https://ventgrey.github.io/tags/rust/>Rust</a></li><li><a href=https://ventgrey.github.io/tags/leftwm/>LeftWM</a></li><li><a href=https://ventgrey.github.io/tags/fifo/>fifo</a></li></ul><nav class=paginav><a class=prev href=https://ventgrey.github.io/posts/rest-api-rocket/><span class=title>« Prev</span><br><span>Crear y consumir una REST API con Rust y Rocket</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Configurar lemonbar en linux on twitter" href="https://twitter.com/intent/tweet/?text=Configurar%20lemonbar%20en%20linux&url=https%3a%2f%2fventgrey.github.io%2fposts%2fconfigurar-lemonbar-en-linux%2f&hashtags=Linux%2cGnu%2cTutoriales%2cWindowManagers%2cC%2cBash%2cRust%2cLeftWM%2cfifo"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Configurar lemonbar en linux on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fventgrey.github.io%2fposts%2fconfigurar-lemonbar-en-linux%2f&title=Configurar%20lemonbar%20en%20linux&summary=Configurar%20lemonbar%20en%20linux&source=https%3a%2f%2fventgrey.github.io%2fposts%2fconfigurar-lemonbar-en-linux%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Configurar lemonbar en linux on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fventgrey.github.io%2fposts%2fconfigurar-lemonbar-en-linux%2f&title=Configurar%20lemonbar%20en%20linux"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Configurar lemonbar en linux on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fventgrey.github.io%2fposts%2fconfigurar-lemonbar-en-linux%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Configurar lemonbar en linux on whatsapp" href="https://api.whatsapp.com/send?text=Configurar%20lemonbar%20en%20linux%20-%20https%3a%2f%2fventgrey.github.io%2fposts%2fconfigurar-lemonbar-en-linux%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Configurar lemonbar en linux on telegram" href="https://telegram.me/share/url?text=Configurar%20lemonbar%20en%20linux&url=https%3a%2f%2fventgrey.github.io%2fposts%2fconfigurar-lemonbar-en-linux%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://ventgrey.github.io/>La Esquina Gris</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>