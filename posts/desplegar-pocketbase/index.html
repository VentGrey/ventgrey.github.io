<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Desplegar PocketBase con NGINX en Ubuntu Server | La Esquina Gris</title><meta name=keywords content="Gnu,Linux,NGINX,Tutoriales,Pocketbase"><meta name=description content="Un rayito de luz para los que queremos un poco de independencia en esta pandemia de tanto SaaS, PaaS y tanto *aaS haya hoy."><meta name=author content="VentGrey"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="Iyb36hxWrYaEXR1JJHRsc-E3vXidjcKH8hdE1pU5KxA"><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ventgrey.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ventgrey.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ventgrey.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ventgrey.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ventgrey.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Desplegar PocketBase con NGINX en Ubuntu Server"><meta property="og:description" content="Un rayito de luz para los que queremos un poco de independencia en esta pandemia de tanto SaaS, PaaS y tanto *aaS haya hoy."><meta property="og:type" content="article"><meta property="og:url" content="https://ventgrey.github.io/posts/desplegar-pocketbase/"><meta property="og:image" content="https://ventgrey.github.io/img/posts/pocketbase/cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-02T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-02T00:00:00+00:00"><meta property="og:site_name" content="La Esquina Gris - Escribo un blog por terapia"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ventgrey.github.io/img/posts/pocketbase/cover.png"><meta name=twitter:title content="Desplegar PocketBase con NGINX en Ubuntu Server"><meta name=twitter:description content="Un rayito de luz para los que queremos un poco de independencia en esta pandemia de tanto SaaS, PaaS y tanto *aaS haya hoy."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ventgrey.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Desplegar PocketBase con NGINX en Ubuntu Server","item":"https://ventgrey.github.io/posts/desplegar-pocketbase/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Desplegar PocketBase con NGINX en Ubuntu Server","name":"Desplegar PocketBase con NGINX en Ubuntu Server","description":"Un rayito de luz para los que queremos un poco de independencia en esta pandemia de tanto SaaS, PaaS y tanto *aaS haya hoy.","keywords":["Gnu","Linux","NGINX","Tutoriales","Pocketbase"],"articleBody":"¿Firebase? ¿Supabase? No gracias, soy hombre simple. Hace poco descubrí un proyecto asombroso gracias al canal de Fireship, este proyecto se llama “Pocketbase” y es asombroso. Piensa en Firebase o Supabase pero, literalmente, “De bolsillo”. Algo así es PocketBase. Una base de datos / PaaS ideal para proyectos pequeños-medianos que necesitan de un backend o incluso una REST API sencilla.\nOtra cosa interesante de PocketBase es que no usa una base de datos como MySQL, PostgreSQL o SQLServer. Pocketbase usa SQLite3 para almacenar los datos. La cosa graciosa es que…bueno, SQLite es una base de datos muy malentendida, más que nada gracias a informáticos chafas, que han repetido puntos negativos que, o bien ya fueron arreglados o falsos en un todo.\nPocketBase utiliza SQLite3 con modo WAL y, según la página de preguntas frecuentes puede llegar a superar el rendimiento de otras bases de datos para operaciones de lectura. Si eso es cierto o no te invito a comprobarlo por tu cuenta.\nEn el mundo del *-as-a-service aun hay esperanza. No soy muy fan de las cosas “As a service”, uno podría usar el ya desgastado argumento de “P-pero es que es más barato”. Sin embargo en muchos casos (inclusive fuera de la tecnología) lo “barato” tiene sus puntos débiles. Principalmente porque depositas o dejas tu dependencia de dicho servicio en las manos de terceros. Acompañado del primer argumento viene el “Pero es que M.A.A.N.G nunca falla”, “Es muy raro que un servicio así falle”, “Es poco el downtime que llegan a tener”.\nEsto no podría estar más alejado de la verdad, manejar un servicio para tantos usuarios y de esas dimensiones es una tarea colosal, el downtime es algo que va a pasar si o si, no importa el tamaño de la empresa ni lo caro de los servicios.\nSi no crees lo que te digo, aquí están los servicios y los downtimes que han tenido en el año 2022, todas las páginas son las “oficiales”:\nDowntime y errores de servicio de Google Cloud Lista de incidentes de GitHub Downtime y lista de incidentes de Vercel Downtime y lista de incidentes de Netlify Lista de incidentes de Heroku Todos estos proveedores de SaaS (Software as a Service) o CaaS (Cosas as a Service xD). Siendo los gigantes tecnológicos que son no están libres del famoso \"¿Quién la cagó?\", frase atribuida al que tira producción, sea humano o máquina.\nNo me malentiendas, If I had a mind to I wouldn’t want to think like you OJO no digo que todo el “*-as-a-service” sea malo, lo que digo es que la dependencia extrema del mismo tiene potencial de ser dañina para quien lo consume. Para muestra las pérdidas generadas por el incendio y fallo de OVHcloud en 2021, donde OVHcloud tuvo que cubrir 3 millones de Euros de su propia bolsa, sumado a eso, las demandas presentadas para pedir compensasión por las pérdidas monetarias generadas que se estiman en 9.2 millones de Euros de acuerdo con el JournalDuNet.\nLa cura esta dependencia extrema a los proveedores externos siempre existe el self-hosting que básicamente es mantener tu propia infraestructura. A esta práctica también la acompañan los argumentos pedorros. “Si M.A.A.N.G tiene downtime o errores ¿Qué esperanza tienes tú?”, “Ellos tienen ingenieros con x años de experiencia, tu nada más eres uno.”, “Es que ellos entregan mejor calidad”, etc. A esto no puedo responder algo más concreto que “hay de dos sopas”.\nSon informáticos con pedos muy serios de confianza en si mismos De plano desarrollaron una dependencia tan fuerte que raya en el grado de lamer una bota. De nuevo, con esto no digo que deberías alojar todo por ti mismo (si puedes hacerlo, mejor), sin embargo, si los servicios son para ti mismo claro que es posible manejar tu propia infraestructura, como muestra tengo el monitoreo de uptime de UpVent que, si observas a detalle podrás notar que en efecto, el sitio principal sufrió downtime y el API tuvo una pausa. Ahora te invito a ver el downtime del sitio principal, fue de 4 minutos algo mucho menor si lo comparamos con los downtimes mencionados anteriormente y claro, es porque mantener un servidor “personal” con infraestructura para pocas personas no es una tarea realmente titánica, menos si eres un buen sysadmin y sabes y conoces las herramientas adecuadas para no mover ni un solo dedo en meses y que tus servidores funcionen como si nada. En mi caso solo dependo de 3 servicios en la nube, mi proveedor de VPS Linode, GitHub para alojar el código fuente y Uptime Robot para monitorear mis sitios. Y si, planeo reducir esa dependencia en un futuro.\n¿Y esto en qué afecta a Ultra Lord? (¿Qué tiene que ver Pocketbase?) PocketBase nos ofrece una forma sencilla de sustituir un SaaS como lo son Supabase y Firebase. Esto con sus respectivas ventajas, por ejemplo, Firebase no es realmente económico y, salvo que sea un experimento su plan “gratis” no ofrece mucho realmente, además de que, si en algún momento necesitamos migrar de servicio tendremos una tarea monumental entre manos.\nCon Supabase las cosas cambian un poco, también tienen un plan gratis y con ese hay un poco más de espacio para maniobrar. Sin embargo, para hacer self-hosting de Supabase no tengo palabras salvo “es un santísimo pedo” de repositorios, contenedores, configuraciones y dios sabrá que cosas más en el futuro.\nAquí es donde entra PocketBase, a diferencia de las otras dos mencionadas, Pocketbase no ofrece plan en la nube ni nada as a service, todo es self hosted si o si. No requiere de mucho mantenimiento, es bastante ligera (11.7 MB cuando se escribió este blog) sin dependencias extra. Y eso es lo que aprenderemos a hacer en este blog, desplegar Pocketbase por nosotros mismos y aprender a explotarla a nuestro favor.\nPreparando el entorno para Pocketbase Para empezar a usar PocketBase tenemos una lista de pre-requisitos que, si conoces este blog ya debería ser evidente para ti, aun así listaré las cosas que necesitamos:\nUn servidor con Ubuntu y acceso por SSH a dicho servidor. NGINX instalado en nuestro servidor. wget instalado en nuestro servidor. Un dominio a donde apuntar nuestra base de datos. unzip instalado en nuestro sevidor. Certbot con soporte de nginx. Paciencia. Prácticamente es todo lo que necesitamos para comenzar a trabajar con PocketBase. Es hora de acceder a nuestro servidor web por medio de ssh y comenzar a trabajar.\nComenzar a trabajar con PocketBase Una vez dentro de nuestro servidor será necesario seguir estos pasos para tener una instancia de PocketBase funcional en poco tiempo:\nInstalar dependencias Primero lo primero, necesitamos instalar nuestras dependencias para que todo funcione correctamente, en nuestro caso solo necesitamos de NGINX y wget. Esto podemos hacerlo de la siguiente forma:\n$ sudo apt install nginx wget unzip certbot python3-certbot-nginx -y Una vez instalados, si nuestro servidor Ubuntu viene con un firewall incluido debemos habilitar el uso de NGINX en el mismo. Usualmente Ubuntu viene con ufw, si es tu caso puedes habilitar el acceso de NGINX con la siguiente orden:\n$ sudo ufw allow 'Nginx Full' Listo, ya tenemos todo lo necesario para ganar. Ahora si, a picarle.\nDescargar pocketbase en un directorio especial. Como buena práctica de sysadmins, vamos a proteger nuestra base de datos para que un solo usuario de unix pueda acceder y manipularla. Así no la dejamos expuesta en el directorio /var/www/html que nos provee NGINX. Para esto vamos a crear un nuevo usuario, en nuestro caso vamos a ponerle camel nomas porque si.\nPara crear a nuestro usuario con todo y mole debemos ejecutar la siguiente línea y llenar los campos que nos pida el script:\n$ sudo adduser camel Nota: Recuerda que adduser es un wrapperscript encima de useradd. Si prefieres algo más “artesanal” puedes optar por sustituirel uso de adduser por useradd y personalizar más el usuario que haremos.\nUna vez creado nuestro usuario entramos en su directorio home y descargamos PocketBase en el mismo:\n# Ingresar al directorio /home del usuario $ sudo su - camel # Una vez dentro del nuevo usuario $ cd Ahora debemos descargar PocketBase usando wget:\n$ wget -O pocketbase.zip https://github.com/pocketbase/pocketbase/releases/download/v0.7.9/pocketbase_0.7.9_linux_amd64.zip Nota: La versión de PocketBase puede ser diferente a cuando escribí este blog. Ante la duda siempre puedes bajar la última versión de Pocketbase en el siguiente enlace.\nCuando Pocketbase se termine de descargar debemos extraerla, darle permisos y ejecutarla al menos una vez para que el directorio de datos se cree por primera vez:\n# Descomprimir PocketBase $ unzip pocketbase.zip # Dar permisos y elminar los archivos innecesarios $ chmod +x pocketbase \u0026\u0026 rm pocketbase.zip LICENSE.md # Ejecutar pocketbase una vez para crear el directorio de archivos ./pocketbase # Cancelar la ejecución con Ctrl-c ^C Si hicimos todo de forma correcta, al ejecutar el comando ls deberíamos ver un nuevo directorio llamado pb_data. Si este directorio existe, podemos continuar, todo salió correctamente.\nCrear un servicio de systemd Llegó el momento de cerrar la sesión del usuario camel que hicimos anteriormente y llegó el momento de pasar a hacer tareas administrativas. En nuestro caso es momento de crear un servicio de systemd que nos permita controlar el uso del binario de pocketbase correctamente.\nVamos a ejecutar la siguiente orden para abrir un nuevo archivo con Vim:\n$ sudo vim /lib/systemd/system/pocketbase.service Ahora dentro del nuevo archivo creado agregamos el siguiente texto:\n[Unit] Description = Servicio de Pocketbase [Service] Type = simple User = camel Group = camel LimitNOFILE = 4096 Restart = always RestartSec = 5s ExecStart = /home/camel/pocketbase serve --http=\"0.0.0.0:8090\" [Install] WantedBy = multi-user.target Por esta ocasión no explicaré línea por línea el servicio de systemd. Solo nos concentraremos en 3 líneas específicamente:\nUser = camel: Le dice a systemd que el servicio se ejecutará con el usuario camel. Group = camel: Le dice a systemd que el servicio se ejecutará con el grupo camel. ExecStart = /home/camel/pocketbase serve --http=\"0.0.0.0:8090\": Le dice a systemd que comando ejecutaremos para iniciar el servicio de PocketBase, además le pasamos la dirección donde deberá servirse nuestra instancia. NOTA: Si queremos utilizar certbot y let’s encrypt para nuestro login, es importante no usar la opción –https aquí. En tu caso deberás sustituir estos tres campos por el usuario, grupo y directorio home del usuario que creaste específicamente para PocketBase.\nUna vez creado nuestro archivo de servicio debemos recargar los archivos de configuración de NGINX e iniciar nuestro servicio de PocketBase:\n$ sudo systemctl daemon-reload \u0026\u0026 sudo systemctl enable --now pocketbase Ahora a comprobar el estado de nuestro servicio con:\n$ sudo systemctl status pocketbase Si la salida es algo similar a esto:\n● pocketbase.service - Servicio de Pocketbase Loaded: loaded (/lib/systemd/system/pocketbase.service; enabled; vendor preset: enabled) Active: active (running) since Sun 2022-09-25 17:59:01 UTC; 1 months 7 days ago noseametiche Main PID: 8011 (pocketbase) Tasks: 10 (limit: 1150) CGroup: /system.slice/pocketbase.service └─801 /home/camel/pocketbase serve --http=0.0.0.0:8090 Sep 32 25:59:01 Serverjsjsjs systemd[1]: Started Servicio de Pocketbase. Sep 32 25:59:02 Serverjsjsjs pocketbase[801]: \u003e Server started at: http://0.0.0.0:8090 Sep 32 25:59:02 Serverjsjsjs pocketbase[801]: - REST API: http://0.0.0.0:8090/api/ Sep 32 25:59:02 Serverjsjsjs pocketbase[801]: - Admin UI: http://0.0.0.0:8090/_/ Felicidades. Ya tienes una instancia de Pocketbase funcionando en tu servidor :D es hora del dolor de cabeza más grande, NGINX.\nCrear un virtual host de NGINX Si tienes un NGINX preconfigurado este paso no será mucho problema. Si no, como dirían los amigos Estadounidenses: godspeed. Llegó el momento de crear un virtual host con nuestro dominio / subdominio apuntando a PocketBase. Los pasos para apuntar un dominio a los DNS de tu proveedor de servidor no los listaré aquí. Esto porque siempre hay variaciones entre proveedores de dominios y de VPS.\nComo superusuario volvemos a abrir un nuevo archivo con vim:\n$ sudo vim /etc/nginx/sites-available/api.ejemplo.com Dentro de ese archivo colocamos el siguiente texto:\nserver { listen 80; listen [::]:80; server_name api.ejemplo.com; location / { proxy_set_header Connection ''; proxy_http_version 1.1; proxy_read_timeout 180s; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-NginX-Proxy true; proxy_pass http://localhost:8090; } } Guardamos y salimos. Ahora debemos habilitar nuestro sitio para que NGINX lo exponga al mundo como la maravilla que es:\n$ sudo ln -s /etc/nginx/sites-available/api.ejemplo.com /etc/nginx/sites-enabled/ Antes de probar nada de URL’s, debemos asegurarnos que la configuración de NGINX es correcta. Esto lo podemos hacer con el comando nginx -t. Si la salida del comando es la siguiente:\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful Ejecutamos sudo systemctl restart nginx, esperamos a que vuelva a levantar NGINX y podemos continuar al siguiente paso.\nAñadir SSL a nuestro login No te sugiero entrar al login de tu sitio web aún. Antes de picarle a nada, te recomiendo configurar el certificado SSL primero, esto lo haremos con certbot de la siguiente forma:\n$ sudo certbot --nginx -d api.ejemplo.com Rellenamos los campos que nos pida certbot y comprobamos que nuestro archivo de NGINX haya sido modificado y funcione correctamente.\nEl archivo de NGINX debería verse así:\nserver { server_name api.ejemplo.com; location / { proxy_set_header Connection ''; proxy_http_version 1.1; proxy_read_timeout 180s; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-NginX-Proxy true; proxy_pass http://localhost:8090; } listen [::]:443 ssl; # managed by Certbot listen 443 ssl; # managed by Certbot ssl_certificate /etc/letsencrypt/live/api.ejemplo.com/fullchain.pem; # managed by Certbot ssl_certificate_key /etc/letsencrypt/live/api.ejemplo.com/privkey.pem; # managed by Certbot include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot } server { if ($host = api.ejemplo.com) { return 301 https://$host$request_uri; } # managed by Certbot listen 80; listen [::]:80; server_name api.ejemplo.com; return 404; # managed by Certbot } Comprobamos la integridad del archivo con nginx -t:\n$ nginx -t nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful Si todo está correcto ya solo es momento de estrenar nuestra nueva BD. Ejecutamos sudo systemctl restart nginx nuevamente, esperamos a que el servidor reinicie de forma correcta y vamos al siguiente paso.\nComenzar a usar PocketBase Bien, si todo nos salió como debería, podemos ir con nuestro navegador a https://api.ejemplo.com/_/ , en tu caso, a la URL de tu dominio personal para PocketBase, en el caso ideal deberíamos ver la siguiente pantalla:\nSi es así ¡Felicidades! Estás list@ para comenzar a utilizar tu propio Backend As A Service hosteado por ti. Deberías estar orgullos@ de tu autonomía como informátic@ :D\nPara aprender a usar PocketBase a detalle puedes consultar la documentación oficial.\nPocketBase también cuenta con un SDK para JavaScript, puedes verlo aquí.\nConclusión PocketBase es una herramienta útil para los programadores que necesitan de un backend sencillo, rápido y sin mucho desorden. Puede llegar a sustituir a una REST API no muy compleja y su SDK de JS permite una interacción muy fluida con las tablas de la misma. Las posibilidades son casi infinitas, personalmente la he visto ser usada como CDN de archivos CSS e imágenes, REST API de blogs, información e incluso como BD de comercios en línea.\nAhora te toca a ti. ¿Qué cosa llevarás al siguiente nivel con PocketBase?\nSi te gustó mi contenido por favor compártelo con tus amigos, de ser posible suscríbete usando el botón de RSS en el fondo de la página o si te sientes con ánimos puedes invitarme un café picando el botón “Tip Me” en la esquina inferior izquierda de tu pantalla :)\n¡Nos leemos pronto!\n","wordCount":"2548","inLanguage":"en","image":"https://ventgrey.github.io/img/posts/pocketbase/cover.png","datePublished":"2022-11-02T00:00:00Z","dateModified":"2022-11-02T00:00:00Z","author":{"@type":"Person","name":"VentGrey"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ventgrey.github.io/posts/desplegar-pocketbase/"},"publisher":{"@type":"Organization","name":"La Esquina Gris","logo":{"@type":"ImageObject","url":"https://ventgrey.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ventgrey.github.io/ accesskey=h title="La Esquina Gris (Alt + H)"><img src=https://ventgrey.github.io/apple-touch-icon.png alt aria-label=logo height=35>La Esquina Gris</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ventgrey.github.io/categories/ title=Categorias><span>Categorias</span></a></li><li><a href=https://ventgrey.github.io/tags/ title=Etiquetas><span>Etiquetas</span></a></li><li><a href=https://upvent.codes title="¿Buscas a UpVent?"><span>¿Buscas a UpVent?</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ventgrey.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://ventgrey.github.io/posts/>Posts</a></div><h1 class=post-title>Desplegar PocketBase con NGINX en Ubuntu Server</h1><div class=post-description>Un rayito de luz para los que queremos un poco de independencia en esta pandemia de tanto SaaS, PaaS y tanto *aaS haya hoy.</div><div class=post-meta><span title='2022-11-02 00:00:00 +0000 UTC'>November 2, 2022</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;2548 words&nbsp;·&nbsp;VentGrey&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/desplegar-pocketbase.md rel="noopener noreferrer" target=_blank>Sugerir Cambios</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#en-el-mundo-del--as-a-service-aun-hay-esperanza>En el mundo del *-as-a-service aun hay esperanza.</a><ul><li><a href=#no-me-malentiendas-if-i-had-a-mind-to-i-wouldnt-want-to-think-like-you>No me malentiendas, If I had a mind to I wouldn&rsquo;t want to think like you</a></li></ul></li><li><a href=#y-esto-en-qué-afecta-a-ultra-lord-qué-tiene-que-ver-pocketbase>¿Y esto en qué afecta a Ultra Lord? (¿Qué tiene que ver Pocketbase?)</a></li><li><a href=#preparando-el-entorno-para-pocketbase>Preparando el entorno para Pocketbase</a></li><li><a href=#comenzar-a-trabajar-con-pocketbase>Comenzar a trabajar con PocketBase</a><ul><li><a href=#instalar-dependencias>Instalar dependencias</a></li><li><a href=#descargar-pocketbase-en-un-directorio-especial>Descargar pocketbase en un directorio especial.</a></li><li><a href=#crear-un-servicio-de-systemd>Crear un servicio de systemd</a></li><li><a href=#crear-un-virtual-host-de-nginx>Crear un virtual host de NGINX</a></li><li><a href=#añadir-ssl-a-nuestro-login>Añadir SSL a nuestro login</a></li><li><a href=#comenzar-a-usar-pocketbase>Comenzar a usar PocketBase</a></li></ul></li><li><a href=#conclusión>Conclusión</a></li></ul></nav></div></details></div><div class=post-content><h1 id=firebase-supabase-no-gracias-soy-hombre-simple>¿Firebase? ¿Supabase? No gracias, soy hombre simple.<a hidden class=anchor aria-hidden=true href=#firebase-supabase-no-gracias-soy-hombre-simple>#</a></h1><p>Hace poco descubrí un proyecto asombroso gracias al canal de <a href=https://fireship.io/>Fireship</a>, este proyecto se llama <em>&ldquo;Pocketbase&rdquo;</em> y es asombroso. Piensa en Firebase o Supabase pero, literalmente, &ldquo;De bolsillo&rdquo;. Algo así es PocketBase. Una
base de datos / PaaS ideal para proyectos pequeños-medianos que necesitan de un backend o incluso una REST API sencilla.</p><p>Otra cosa interesante de PocketBase es que no usa una base de datos como MySQL, PostgreSQL o SQLServer. Pocketbase usa <em>SQLite3</em> para almacenar los datos. La cosa graciosa es que&mldr;bueno, <em>SQLite</em> es una base de datos muy malentendida, más que nada gracias a informáticos chafas, que han repetido puntos negativos que, o bien ya fueron arreglados o falsos en un todo.</p><p>PocketBase utiliza <em>SQLite3</em> con modo <em>WAL</em> y, según la <a href=https://pocketbase.io/faq/>página de preguntas frecuentes</a> puede llegar a superar el rendimiento de otras bases de datos para operaciones de lectura. Si eso es cierto o no <a href=https://ericdraken.com/sqlite-performance-testing/>te invito a comprobarlo</a> por tu cuenta.</p><h2 id=en-el-mundo-del--as-a-service-aun-hay-esperanza>En el mundo del *-as-a-service aun hay esperanza.<a hidden class=anchor aria-hidden=true href=#en-el-mundo-del--as-a-service-aun-hay-esperanza>#</a></h2><p><img loading=lazy src=/img/posts/pocketbase/soy-verless.jpg alt=soyrverless></p><p>No soy muy fan de las cosas <em>&ldquo;As a service&rdquo;</em>, uno podría usar el ya desgastado argumento de <em>&ldquo;P-pero es que es más barato&rdquo;</em>. Sin embargo en muchos casos (inclusive fuera de la tecnología) lo <em>&ldquo;barato&rdquo;</em> tiene sus puntos débiles. Principalmente porque depositas o dejas tu dependencia de dicho servicio en las manos de terceros. Acompañado del primer argumento viene el &ldquo;Pero es que <strong>M.A.A.N.G</strong> nunca falla&rdquo;, &ldquo;Es muy raro que un servicio así falle&rdquo;, &ldquo;Es poco el downtime que llegan a tener&rdquo;.</p><p>Esto no podría estar más alejado de la verdad, manejar un servicio para tantos usuarios y de esas dimensiones es una tarea colosal, el downtime es algo que va a pasar si o si, no importa el tamaño de la empresa ni lo caro de los servicios.</p><p>Si no crees lo que te digo, aquí están los servicios y los downtimes que han tenido en el año 2022, todas las páginas son las &ldquo;oficiales&rdquo;:</p><ul><li><a href=https://status.cloud.google.com/summary>Downtime y errores de servicio de Google Cloud</a></li><li><a href=https://www.githubstatus.com/history>Lista de incidentes de GitHub</a></li><li><a href=https://www.vercel-status.com/>Downtime y lista de incidentes de Vercel</a></li><li><a href=https://www.netlifystatus.com/history>Downtime y lista de incidentes de Netlify</a></li><li><a href=https://status.heroku.com/incidents>Lista de incidentes de Heroku</a></li></ul><p>Todos estos proveedores de SaaS (<em>Software as a Service</em>) o <em>CaaS</em> (Cosas as a Service xD). Siendo los gigantes tecnológicos que son no están libres del famoso <em>"¿Quién la cagó?"</em>, frase atribuida al que tira producción, sea humano o máquina.</p><h3 id=no-me-malentiendas-if-i-had-a-mind-to-i-wouldnt-want-to-think-like-you>No me malentiendas, If I had a mind to I wouldn&rsquo;t want to think like you<a hidden class=anchor aria-hidden=true href=#no-me-malentiendas-if-i-had-a-mind-to-i-wouldnt-want-to-think-like-you>#</a></h3><p><strong>OJO</strong> no digo que todo el &ldquo;*-as-a-service&rdquo; sea malo, lo que digo es que la dependencia extrema del mismo tiene potencial de ser dañina para quien lo consume. Para muestra las pérdidas generadas por el incendio y fallo de <a href=https://www.datacenterdynamics.com/en/news/ovhcloud-reports-14-percent-growth-but-last-years-fire-caused-a-loss/>OVHcloud</a> en 2021, donde OVHcloud tuvo que cubrir 3 millones de Euros de su propia bolsa, sumado a eso, las <a href=https://www.datacenterdynamics.com/en/news/ovhcloud-fire-losses-103-join-class-action-four-firms-sue-individually/>demandas presentadas</a> para pedir compensasión por las pérdidas monetarias generadas que se estiman en 9.2 millones de Euros de acuerdo con el <a href="https://www.journaldunet.com/web-tech/cloud/1509029-exclusif-103-entreprises-reclament-plus-de-9-millions-d-euros-de-dedommagement-a-ovh/?utm_campaign=Quotidienne_2022-02-04&utm_medium=email&seen=2&utm_source=MagNews&een=5a09c20e56d482d345813f3f04d0bace">JournalDuNet</a>.</p><p>La cura esta dependencia extrema a los proveedores externos siempre existe el <em>self-hosting</em> que básicamente es mantener tu propia infraestructura. A esta práctica también la acompañan los argumentos pedorros. &ldquo;Si <strong>M.A.A.N.G</strong> tiene downtime o errores ¿Qué esperanza tienes tú?&rdquo;, &ldquo;Ellos tienen ingenieros con x años de experiencia, tu nada más eres uno.&rdquo;, &ldquo;Es que ellos entregan mejor calidad&rdquo;, etc. A esto no puedo responder algo más concreto que &ldquo;<em>hay de dos sopas</em>&rdquo;.</p><ol><li>Son informáticos con pedos muy serios de confianza en si mismos</li><li>De plano desarrollaron una dependencia tan fuerte que raya en el grado de lamer una bota.</li></ol><p>De nuevo, con esto no digo que deberías alojar todo por ti mismo (si puedes hacerlo, mejor), sin embargo, si los servicios son para ti mismo claro que es posible manejar tu propia infraestructura, como muestra tengo el <a href=https://stats.uptimerobot.com/qXywYt1lg9>monitoreo de uptime de UpVent</a> que, si observas a detalle podrás notar que en efecto, el sitio principal sufrió downtime y el API tuvo una pausa. Ahora te invito a ver el downtime del sitio principal, fue de 4 minutos algo mucho menor si lo comparamos con los downtimes mencionados anteriormente y claro, es porque mantener un servidor &ldquo;personal&rdquo; con infraestructura para pocas personas no es una tarea realmente titánica, menos si eres un buen sysadmin y sabes y conoces las herramientas adecuadas para no mover ni un solo dedo en meses y que tus servidores funcionen <em>como si nada</em>. En mi caso solo dependo de 3 servicios en la nube, mi proveedor de VPS <a href="https://www.linode.com/lp/refer/?r=2b48a57a9c813fa9972e3287171358c4f36746af">Linode</a>, <a href=https://github.com/UpVent>GitHub</a> para alojar el código fuente y <a href="https://uptimerobot.com/?rid=89ab54e5cbe447">Uptime Robot</a> para monitorear mis sitios. Y si, planeo reducir esa dependencia en un futuro.</p><h2 id=y-esto-en-qué-afecta-a-ultra-lord-qué-tiene-que-ver-pocketbase>¿Y esto en qué afecta a Ultra Lord? (¿Qué tiene que ver Pocketbase?)<a hidden class=anchor aria-hidden=true href=#y-esto-en-qué-afecta-a-ultra-lord-qué-tiene-que-ver-pocketbase>#</a></h2><p>PocketBase nos ofrece una forma sencilla de sustituir un SaaS como lo son Supabase y Firebase. Esto con sus respectivas ventajas, por ejemplo, Firebase no es realmente económico y, salvo que sea un experimento su plan <em>&ldquo;gratis&rdquo;</em> no ofrece mucho realmente, además de que, si en algún momento necesitamos migrar de servicio tendremos una tarea monumental entre manos.</p><p>Con Supabase las cosas cambian un poco, también tienen un plan gratis y con ese hay un poco más de espacio para maniobrar. Sin embargo, para hacer <em>self-hosting</em> de Supabase no tengo palabras salvo <em>&ldquo;es un santísimo pedo&rdquo;</em> de repositorios, contenedores, configuraciones y dios sabrá que cosas más en el futuro.</p><p>Aquí es donde entra PocketBase, a diferencia de las otras dos mencionadas, Pocketbase no ofrece plan en la nube ni nada <em>as a service</em>, todo es <em>self hosted</em> si o si. No requiere de mucho mantenimiento, es bastante ligera (11.7 MB cuando se escribió este blog) sin dependencias extra. Y eso es lo que aprenderemos a hacer en este blog, desplegar Pocketbase por nosotros mismos y aprender a explotarla a nuestro favor.</p><h2 id=preparando-el-entorno-para-pocketbase>Preparando el entorno para Pocketbase<a hidden class=anchor aria-hidden=true href=#preparando-el-entorno-para-pocketbase>#</a></h2><p>Para empezar a usar PocketBase tenemos una lista de pre-requisitos que, si conoces este blog ya debería ser evidente para ti, aun así listaré las cosas que necesitamos:</p><ul><li>Un servidor con Ubuntu y acceso por SSH a dicho servidor.</li><li>NGINX instalado en nuestro servidor.</li><li>wget instalado en nuestro servidor.</li><li>Un dominio a donde apuntar nuestra base de datos.</li><li>unzip instalado en nuestro sevidor.</li><li>Certbot con soporte de nginx.</li><li>Paciencia.</li></ul><p>Prácticamente es todo lo que necesitamos para comenzar a trabajar con PocketBase. Es hora de acceder a nuestro servidor web por medio de ssh y comenzar a trabajar.</p><h2 id=comenzar-a-trabajar-con-pocketbase>Comenzar a trabajar con PocketBase<a hidden class=anchor aria-hidden=true href=#comenzar-a-trabajar-con-pocketbase>#</a></h2><p>Una vez dentro de nuestro servidor será necesario seguir estos pasos para tener una instancia de PocketBase funcional en poco tiempo:</p><h3 id=instalar-dependencias>Instalar dependencias<a hidden class=anchor aria-hidden=true href=#instalar-dependencias>#</a></h3><p>Primero lo primero, necesitamos instalar nuestras dependencias para que todo funcione correctamente, en nuestro caso solo necesitamos de NGINX y wget. Esto podemos hacerlo de la siguiente forma:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo apt install nginx wget unzip certbot python3-certbot-nginx -y
</span></span></code></pre></div><p>Una vez instalados, si nuestro servidor Ubuntu viene con un firewall incluido debemos habilitar el uso de NGINX en el mismo. Usualmente Ubuntu viene con <code>ufw</code>, si es tu caso puedes habilitar el acceso de NGINX con la siguiente orden:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo ufw allow <span class=s1>&#39;Nginx Full&#39;</span>
</span></span></code></pre></div><p>Listo, ya tenemos todo lo necesario para ganar. Ahora si, a picarle.</p><h3 id=descargar-pocketbase-en-un-directorio-especial>Descargar pocketbase en un directorio especial.<a hidden class=anchor aria-hidden=true href=#descargar-pocketbase-en-un-directorio-especial>#</a></h3><p>Como buena práctica de sysadmins, vamos a proteger nuestra base de datos para que un solo usuario de unix pueda acceder y manipularla. Así no la dejamos expuesta en el directorio <code>/var/www/html</code> que nos provee NGINX. Para esto vamos a crear un nuevo usuario, en nuestro caso vamos a ponerle <code>camel</code> nomas porque si.</p><p>Para crear a nuestro usuario con todo y mole debemos ejecutar la siguiente línea y llenar los campos que nos pida el script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo adduser camel
</span></span></code></pre></div><blockquote><p>Nota: Recuerda que <code>adduser</code> es un wrapperscript encima de <code>useradd</code>. Si prefieres algo más &ldquo;artesanal&rdquo; puedes optar por sustituirel uso de <code>adduser</code> por <code>useradd</code> y personalizar más el usuario que haremos.</p></blockquote><p>Una vez creado nuestro usuario entramos en su directorio home y descargamos PocketBase en el mismo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Ingresar al directorio /home del usuario</span>
</span></span><span class=line><span class=cl>$ sudo su - camel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Una vez dentro del nuevo usuario</span>
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span>
</span></span></code></pre></div><p>Ahora debemos descargar PocketBase usando wget:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ wget -O pocketbase.zip https://github.com/pocketbase/pocketbase/releases/download/v0.7.9/pocketbase_0.7.9_linux_amd64.zip
</span></span></code></pre></div><blockquote><p>Nota: La versión de PocketBase puede ser diferente a cuando escribí este blog. Ante la duda siempre puedes bajar la última versión de Pocketbase en el siguiente <a href=https://github.com/pocketbase/pocketbase/releases/latest>enlace</a>.</p></blockquote><p>Cuando Pocketbase se termine de descargar debemos extraerla, darle permisos y ejecutarla al menos una vez para que el directorio de datos se cree por primera vez:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Descomprimir PocketBase</span>
</span></span><span class=line><span class=cl>$ unzip pocketbase.zip
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Dar permisos y elminar los archivos innecesarios</span>
</span></span><span class=line><span class=cl>$ chmod +x pocketbase <span class=o>&amp;&amp;</span> rm pocketbase.zip LICENSE.md
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Ejecutar pocketbase una vez para crear el directorio de archivos</span>
</span></span><span class=line><span class=cl>./pocketbase
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Cancelar la ejecución con Ctrl-c</span>
</span></span><span class=line><span class=cl>^C
</span></span></code></pre></div><p>Si hicimos todo de forma correcta, al ejecutar el comando <code>ls</code> deberíamos ver un nuevo directorio llamado <code>pb_data</code>. Si este directorio existe, podemos continuar, todo salió correctamente.</p><h3 id=crear-un-servicio-de-systemd>Crear un servicio de systemd<a hidden class=anchor aria-hidden=true href=#crear-un-servicio-de-systemd>#</a></h3><p>Llegó el momento de cerrar la sesión del usuario <code>camel</code> que hicimos anteriormente y llegó el momento de pasar a hacer tareas administrativas. En nuestro caso es momento de crear un servicio de systemd que nos permita controlar el uso del binario de pocketbase correctamente.</p><p>Vamos a ejecutar la siguiente orden para abrir un nuevo archivo con Vim:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo vim /lib/systemd/system/pocketbase.service
</span></span></code></pre></div><p>Ahora dentro del nuevo archivo creado agregamos el siguiente texto:</p><pre tabindex=0><code class=language-conf data-lang=conf>[Unit]
Description = Servicio de Pocketbase

[Service]
Type = simple
User = camel
Group = camel
LimitNOFILE = 4096
Restart = always
RestartSec = 5s
ExecStart = /home/camel/pocketbase serve --http=&#34;0.0.0.0:8090&#34;

[Install] 
WantedBy = multi-user.target
</code></pre><p>Por esta ocasión no explicaré línea por línea el servicio de systemd. Solo nos concentraremos en 3 líneas específicamente:</p><ul><li><code>User = camel</code>: Le dice a systemd que el servicio se ejecutará con el usuario <code>camel</code>.</li><li><code>Group = camel</code>: Le dice a systemd que el servicio se ejecutará con el grupo <code>camel</code>.</li><li><code>ExecStart = /home/camel/pocketbase serve --http="0.0.0.0:8090"</code>: Le dice a systemd que comando ejecutaremos para iniciar el servicio de PocketBase, además le pasamos la dirección donde deberá servirse nuestra instancia. <strong>NOTA: Si queremos utilizar certbot y let&rsquo;s encrypt para nuestro login, es importante no usar la opción &ndash;https aquí.</strong></li></ul><p>En tu caso deberás sustituir estos tres campos por el usuario, grupo y directorio home del usuario que creaste específicamente para PocketBase.</p><p>Una vez creado nuestro archivo de servicio debemos recargar los archivos de configuración de NGINX e iniciar nuestro servicio de PocketBase:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo systemctl daemon-reload <span class=o>&amp;&amp;</span> sudo systemctl <span class=nb>enable</span> --now pocketbase
</span></span></code></pre></div><p>Ahora a comprobar el estado de nuestro servicio con:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo systemctl status pocketbase
</span></span></code></pre></div><p>Si la salida es algo similar a esto:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>● pocketbase.service - Servicio de Pocketbase
</span></span><span class=line><span class=cl>   Loaded: loaded <span class=o>(</span>/lib/systemd/system/pocketbase.service<span class=p>;</span> enabled<span class=p>;</span> vendor preset: enabled<span class=o>)</span>
</span></span><span class=line><span class=cl>   Active: active <span class=o>(</span>running<span class=o>)</span> since Sun 2022-09-25 17:59:01 UTC<span class=p>;</span> <span class=m>1</span> months <span class=m>7</span> days ago noseametiche
</span></span><span class=line><span class=cl> Main PID: <span class=m>8011</span> <span class=o>(</span>pocketbase<span class=o>)</span>
</span></span><span class=line><span class=cl>    Tasks: <span class=m>10</span> <span class=o>(</span>limit: 1150<span class=o>)</span>
</span></span><span class=line><span class=cl>   CGroup: /system.slice/pocketbase.service
</span></span><span class=line><span class=cl>           └─801 /home/camel/pocketbase serve --http<span class=o>=</span>0.0.0.0:8090
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Sep <span class=m>32</span> 25:59:01 Serverjsjsjs systemd<span class=o>[</span>1<span class=o>]</span>: Started Servicio de Pocketbase.
</span></span><span class=line><span class=cl>Sep <span class=m>32</span> 25:59:02 Serverjsjsjs pocketbase<span class=o>[</span>801<span class=o>]</span>: &gt; Server started at: http://0.0.0.0:8090
</span></span><span class=line><span class=cl>Sep <span class=m>32</span> 25:59:02 Serverjsjsjs pocketbase<span class=o>[</span>801<span class=o>]</span>:   - REST API: http://0.0.0.0:8090/api/
</span></span><span class=line><span class=cl>Sep <span class=m>32</span> 25:59:02 Serverjsjsjs pocketbase<span class=o>[</span>801<span class=o>]</span>:   - Admin UI: http://0.0.0.0:8090/_/
</span></span></code></pre></div><p>Felicidades. Ya tienes una instancia de Pocketbase funcionando en tu servidor :D es hora del dolor de cabeza más grande, NGINX.</p><h3 id=crear-un-virtual-host-de-nginx>Crear un virtual host de NGINX<a hidden class=anchor aria-hidden=true href=#crear-un-virtual-host-de-nginx>#</a></h3><p>Si tienes un NGINX preconfigurado este paso no será mucho problema. Si no, como dirían los amigos Estadounidenses: <em>godspeed</em>. Llegó el momento de crear un virtual host con nuestro dominio / subdominio apuntando a PocketBase. Los pasos para apuntar un dominio a los DNS de tu proveedor de servidor no los listaré aquí. Esto porque siempre hay variaciones entre proveedores de dominios y de VPS.</p><p>Como superusuario volvemos a abrir un nuevo archivo con vim:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo vim /etc/nginx/sites-available/api.ejemplo.com
</span></span></code></pre></div><p>Dentro de ese archivo colocamos el siguiente texto:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>api.ejemplo.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Connection</span> <span class=s>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_http_version</span> <span class=mi>1</span><span class=s>.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_read_timeout</span> <span class=s>180s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-Proto</span> <span class=nv>$scheme</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    	<span class=kn>proxy_set_header</span> <span class=s>X-NginX-Proxy</span> <span class=s>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://localhost:8090</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Guardamos y salimos. Ahora debemos habilitar nuestro sitio para que NGINX lo exponga al mundo como la maravilla que es:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo ln -s /etc/nginx/sites-available/api.ejemplo.com /etc/nginx/sites-enabled/
</span></span></code></pre></div><p>Antes de probar nada de URL&rsquo;s, debemos asegurarnos que la configuración de NGINX es correcta. Esto lo podemos hacer con el comando <code>nginx -t</code>. Si la salida del comando es la siguiente:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
</span></span><span class=line><span class=cl>nginx: configuration file /etc/nginx/nginx.conf <span class=nb>test</span> is successful
</span></span></code></pre></div><p>Ejecutamos <code>sudo systemctl restart nginx</code>, esperamos a que vuelva a levantar NGINX y podemos continuar al siguiente paso.</p><h3 id=añadir-ssl-a-nuestro-login>Añadir SSL a nuestro login<a hidden class=anchor aria-hidden=true href=#añadir-ssl-a-nuestro-login>#</a></h3><p>No te sugiero entrar al login de tu sitio web aún. Antes de picarle a nada, te recomiendo configurar el certificado SSL primero, esto lo haremos con certbot de la siguiente forma:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo certbot --nginx -d api.ejemplo.com
</span></span></code></pre></div><p>Rellenamos los campos que nos pida certbot y comprobamos que nuestro archivo de NGINX haya sido modificado y funcione correctamente.</p><p>El archivo de NGINX debería verse así:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>api.ejemplo.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Connection</span> <span class=s>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_http_version</span> <span class=mi>1</span><span class=s>.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_read_timeout</span> <span class=s>180s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-Proto</span> <span class=nv>$scheme</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kn>proxy_set_header</span> <span class=s>X-NginX-Proxy</span> <span class=s>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://localhost:8090</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:443</span> <span class=s>ssl</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>listen</span> <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>ssl_certificate</span> <span class=s>/etc/letsencrypt/live/api.ejemplo.com/fullchain.pem</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>ssl_certificate_key</span> <span class=s>/etc/letsencrypt/live/api.ejemplo.com/privkey.pem</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>include</span> <span class=s>/etc/letsencrypt/options-ssl-nginx.conf</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>ssl_dhparam</span> <span class=s>/etc/letsencrypt/ssl-dhparams.pem</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>if</span> <span class=s>(</span><span class=nv>$host</span> <span class=p>=</span> <span class=s>api.ejemplo.com)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>api.ejemplo.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>404</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>Comprobamos la integridad del archivo con <code>nginx -t</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ nginx -t
</span></span><span class=line><span class=cl>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
</span></span><span class=line><span class=cl>nginx: configuration file /etc/nginx/nginx.conf <span class=nb>test</span> is successful
</span></span></code></pre></div><p>Si todo está correcto ya solo es momento de estrenar nuestra nueva BD. Ejecutamos <code>sudo systemctl restart nginx</code> nuevamente, esperamos a que el servidor reinicie de forma correcta y vamos al siguiente paso.</p><h3 id=comenzar-a-usar-pocketbase>Comenzar a usar PocketBase<a hidden class=anchor aria-hidden=true href=#comenzar-a-usar-pocketbase>#</a></h3><p>Bien, si todo nos salió como debería, podemos ir con nuestro navegador a <a href=https://api.ejemplo.com/_/>https://api.ejemplo.com/_/</a> , en tu caso, a la URL de tu dominio personal para PocketBase, en el caso ideal deberíamos ver la siguiente pantalla:</p><p><img loading=lazy src=/img/posts/pocketbase/pocketlogin.png alt=crearusuariojsjsjs></p><p>Si es así ¡Felicidades! Estás list@ para comenzar a utilizar tu propio <em>Backend As A Service</em> hosteado por ti. Deberías estar orgullos@ de tu autonomía como informátic@ :D</p><p>Para aprender a usar PocketBase a detalle puedes consultar la <a href=https://pocketbase.io/docs/>documentación oficial</a>.</p><p>PocketBase también cuenta con un SDK para JavaScript, puedes verlo <a href=https://github.com/pocketbase/js-sdk>aquí</a>.</p><h2 id=conclusión>Conclusión<a hidden class=anchor aria-hidden=true href=#conclusión>#</a></h2><p>PocketBase es una herramienta útil para los programadores que necesitan de un backend sencillo, rápido y sin mucho desorden. Puede llegar a sustituir a una REST API no muy compleja y su SDK de JS permite una interacción muy fluida con las tablas de la misma. Las posibilidades son casi infinitas, personalmente la he visto ser usada como CDN de archivos CSS e imágenes, REST API de blogs, información e incluso como BD de comercios en línea.</p><p>Ahora te toca a ti. ¿Qué cosa llevarás al siguiente nivel con PocketBase?</p><p>Si te gustó mi contenido por favor compártelo con tus amigos, de ser posible suscríbete usando el botón de RSS en el fondo de la página o si te sientes con ánimos puedes invitarme un café picando el botón &ldquo;Tip Me&rdquo; en la esquina inferior izquierda de tu pantalla :)</p><p>¡Nos leemos pronto!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ventgrey.github.io/tags/gnu/>Gnu</a></li><li><a href=https://ventgrey.github.io/tags/linux/>Linux</a></li><li><a href=https://ventgrey.github.io/tags/nginx/>NGINX</a></li><li><a href=https://ventgrey.github.io/tags/tutoriales/>Tutoriales</a></li><li><a href=https://ventgrey.github.io/tags/pocketbase/>Pocketbase</a></li></ul><nav class=paginav><a class=next href=https://ventgrey.github.io/posts/manejar-administrar-rocky/><span class=title>Next »</span><br><span>Manejo y administración de usuarios en Rocky Linux 9 y Alma Linux 9</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Desplegar PocketBase con NGINX en Ubuntu Server on twitter" href="https://twitter.com/intent/tweet/?text=Desplegar%20PocketBase%20con%20NGINX%20en%20Ubuntu%20Server&url=https%3a%2f%2fventgrey.github.io%2fposts%2fdesplegar-pocketbase%2f&hashtags=Gnu%2cLinux%2cNGINX%2cTutoriales%2cPocketbase"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Desplegar PocketBase con NGINX en Ubuntu Server on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fventgrey.github.io%2fposts%2fdesplegar-pocketbase%2f&title=Desplegar%20PocketBase%20con%20NGINX%20en%20Ubuntu%20Server&summary=Desplegar%20PocketBase%20con%20NGINX%20en%20Ubuntu%20Server&source=https%3a%2f%2fventgrey.github.io%2fposts%2fdesplegar-pocketbase%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Desplegar PocketBase con NGINX en Ubuntu Server on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fventgrey.github.io%2fposts%2fdesplegar-pocketbase%2f&title=Desplegar%20PocketBase%20con%20NGINX%20en%20Ubuntu%20Server"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Desplegar PocketBase con NGINX en Ubuntu Server on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fventgrey.github.io%2fposts%2fdesplegar-pocketbase%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Desplegar PocketBase con NGINX en Ubuntu Server on whatsapp" href="https://api.whatsapp.com/send?text=Desplegar%20PocketBase%20con%20NGINX%20en%20Ubuntu%20Server%20-%20https%3a%2f%2fventgrey.github.io%2fposts%2fdesplegar-pocketbase%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Desplegar PocketBase con NGINX en Ubuntu Server on telegram" href="https://telegram.me/share/url?text=Desplegar%20PocketBase%20con%20NGINX%20en%20Ubuntu%20Server&url=https%3a%2f%2fventgrey.github.io%2fposts%2fdesplegar-pocketbase%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://ventgrey.github.io/>La Esquina Gris</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>